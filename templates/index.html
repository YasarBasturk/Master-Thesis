<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Text Editor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container-fluid">
        <header class="bg-primary text-white text-center py-3 mb-4">
            <h1>OCR Text Editor</h1>
            <p class="lead">Upload, view, and correct OCR results</p>
            {% if has_template %}
            <div class="template-badge">
                <i class="bi bi-check-circle-fill"></i> Template Loaded
            </div>
            {% else %}
            <div class="template-badge template-missing">
                <i class="bi bi-exclamation-triangle-fill"></i> No Template Found
            </div>
            {% endif %}
        </header>

        <div class="row">
            <!-- File Upload Section -->
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title">Upload Files</h3>
                    </div>
                    <div class="card-body">
                        {% if has_template %}
                        <div class="alert alert-success mb-3">
                            <i class="bi bi-info-circle"></i> 
                            <strong>Template Active:</strong> The system will use the template to identify which text is editable.
                        </div>
                        {% else %}
                        <div class="alert alert-warning mb-3">
                            <i class="bi bi-exclamation-triangle"></i> 
                            <strong>No Template Found:</strong> The system will try to guess which text is editable. 
                            Please use the "Set Template" section below first.
                        </div>
                        {% endif %}
                        <form id="uploadForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="jsonFile" class="form-label">JSON File</label>
                                <input type="file" class="form-control" id="jsonFile" accept=".json" required>
                                <div class="form-text">Upload your OCR JSON results</div>
                            </div>
                            <div class="mb-3">
                                <label for="imageFile" class="form-label">Image File</label>
                                <input type="file" class="form-control" id="imageFile" accept="image/*" required>
                                <div class="form-text">Upload the original image</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Load Data</button>
                        </form>
                    </div>
                </div>
                
                <!-- Template Upload Section -->
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h3 class="card-title">Set Template</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle"></i> 
                            <strong>Template Setup:</strong> Upload your res_0.json file to set as template. 
                            Text matching this template will not be editable.
                        </div>
                        <form id="templateForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="templateFile" class="form-label">Template JSON File</label>
                                <input type="file" class="form-control" id="templateFile" accept=".json" required>
                                <div class="form-text">Upload your template JSON file (res_0.json)</div>
                            </div>
                            <button type="submit" class="btn btn-info">Set As Template</button>
                        </form>
                        <div id="templateResult" class="mt-2"></div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header bg-success text-white">
                        <h3 class="card-title">Save</h3>
                    </div>
                    <div class="card-body">
                        <button id="saveBtn" class="btn btn-success" disabled>Save Corrected JSON</button>
                        <div id="saveResult" class="mt-2"></div>
                    </div>
                </div>
            </div>

            <!-- Image Display Section -->
            <div class="col-md-8 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title">Annotated Image</h3>
                    </div>
                    <div class="card-body text-center" id="imageContainer">
                        <p class="text-muted">Upload files to view the annotated image</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text Editing Section -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title">OCR Text Results</h3>
                    </div>
                    <div class="card-body">
                        <div id="textResults">
                            <p class="text-muted">Upload files to view and edit OCR text results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="spinner" class="spinner-overlay d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Template Success Modal -->
    <div class="modal fade" id="templateSuccessModal" tabindex="-1" aria-labelledby="templateSuccessModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="templateSuccessModalLabel">Template Set Successfully</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Your template has been uploaded and set successfully! You can now proceed to upload your JSON and image files.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Pass template status to JavaScript
        const hasTemplate = {% if has_template %}true{% else %}false{% endif %};
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html> 